//- helper functions
include helpers.pug

mixin mdTag(parent, tag)
  if tag[0] === 'text'
    | #{tag[1]}
    each subtag in tag[2]
      +mdTag(tag, subtag)
  else
    #{tag[0]}&attributes(tag[3]) #{tag[1]}
      each subtag in tag[2]
        +mdTag(tag, subtag)

mixin mdText(tag)
  #{tag[0]}&attributes(tag[3]) #{tag[1]}
    each subtag in tag[2]
      +mdTag(tag, subtag)


doctype html
html(lang='en')
  head
    title Archivium
    link(rel='stylesheet' href=`${ADDR_PREFIX}/static/assets/styles.css`)
    link(rel='icon' type='image/x-icon' href=`${ADDR_PREFIX}/static/assets/icons/archivium.ico`)
    script!= `const locale = JSON.parse('${JSON.stringify(locale)}');`
    script.
      function T(str) {
        return locale[str] ?? str;
      }
    block scripts

  body
    header
      nav.navbar
        script.
          window.onscroll = () => {
            if (document.body.scrollTop > 8 || document.documentElement.scrollTop > 8) {
              document.querySelector('header').classList.add('nav-fullwidth');
            } else {
              document.querySelector('header').classList.remove('nav-fullwidth');
            }
          }
        ul.navbarBtns.shrink-1.scroll-x
          li.navbarBtn
            a.navbarBtnLink.navbarText(href=`${ADDR_PREFIX}/`) Home
          if !displayUniverse
            li.navbarBtn
              a.navbarBtnLink.navbarText(href=`${ADDR_PREFIX}/contacts`) Contacts
            li.navbarBtn
              a.navbarBtnLink.navbarText(href=`${ADDR_PREFIX}/universes`) Universes
          li.navbarBtn
            a.navbarBtnLink.navbarText(href=`${ADDR_PREFIX}/search`) Search
        if !displayUniverse
          ul.navbarBtns
            block save
            if contextUser
              li.navbarBtn( style={ position: 'relative' } )
                script.
                  function toggleUserDropdown() {
                    const drop = document.querySelector('.user-dropdown');
                    drop.classList.toggle('hidden');
                  }
                a.navbarBtnLink.d-flex.align-center( onclick='toggleUserDropdown()' )
                  img.pfp( src=contextUser.gravatarLink )
                  span.navbarText #{contextUser.username} &#x23F7;
                .user-dropdown.hidden
                  ul.navbarBtns.flex-col
                    li.navbarBtn
                      a.navbarBtnLink.navbarText.text-start(href=`${ADDR_PREFIX}/users/${contextUser.username}`) Profile
                    li.navbarBtn
                      a.navbarBtnLink.navbarText.text-start(href=`${ADDR_PREFIX}/logout`) Log Out
            else
              ul.navbarBtns
                if curTemplate !== 'login'
                  li.navbarBtn
                    a.navbarBtnLink.navbarText(href=`${ADDR_PREFIX}/login${curTemplate === 'signup' ? '' : `?${encodedPath}`}`) Login
                if curTemplate !== 'signup'
                  li.navbarBtn
                    a.navbarBtnLink.navbarText(href=`${ADDR_PREFIX}/signup${curTemplate === 'login' ? '' : `?${encodedPath}`}`) Sign Up

    main
      .page
        block breadcrumbs
        block content

    footer
      small.d-flex.justify-center.gap-4.flex-wrap
        .d-flex.justify-center.gap-1.flex-wrap
          a.link.link-animated( href=`${ADDR_PREFIX}/privacy-policy` ) Privacy Policy
          span —
          a.link.link-animated( href=`${ADDR_PREFIX}/terms-of-service` ) Terms of Service
          span —
          a.link.link-animated( href=`${ADDR_PREFIX}/code-of-conduct` ) Code of Conduct
        span &copy; 2024 Archivium. Developed by 
          a.link.link-animated( href='https://github.com/kjniemela' ) kjniemela
          |  &amp; 
          a.link.link-animated( href='https://github.com/JoelNiemela' ) JoelNiemela
          | .
        span Open source on 
          a.link.link-animated( href='https://github.com/JoelNiemela/archivium' ) GitHub.
